<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>编辑商品详情规格-会员中心</title>
{include file="/member/m_header"}
<link rel="stylesheet" type="text/css" href="{$Think.config.web_member}/css/style.css"/>
<style>
label{cursor:pointer;}
.pop_box{display:none;}
.pop_boxc01{margin:-250px 0 0 -450px;}
span.chkbg{background:url(__STATIC__/images/chkbg.png) no-repeat right bottom;border:2px solid #c30007;height:24px;}
#snidlie{display:none;}
#snvidlie{display:none;}
</style>
<style>
/*列表表格*/
table.listTable{background:#f6f6f6;border:1px solid #ddd;border-collapse:collapse;margin:15px 0px 8px 0px;}
table.listTable tr.thead th{background:#f6f6f6;border-bottom:1px solid #ddd;border-right:1px solid #ddd;
text-align:left;font-size:14px;color:#222;font-weight:normal;
padding:10px 10px 10px 10px;overflow:hidden;height:16px;line-height:16px;}
table.listTable tr.thead-normal th{ font-weight:normal;}
table.listTable tr.data td,table.listTable tr.pages td{padding:8px 10px 8px 10px;height:24px;line-height:160%;
text-align:left;font-size:14px;border-left:1px solid #e8e8e8;border-top:1px solid #e8e8e8;}
table.listTable tr.data td:first-child{border-left:1px solid #ddd;}
table.listTable tr.data td.spec-value{ background-color:#fff9fa; padding-left:8px; padding-right:10px;}
table.listTable tr.pages td{border-left:1px solid #ddd;}
table.listTable tr.data td{background:#fff;}
table.listTable tr.eline td{background:#f6f6f6}
table.listTable tr.data:hover td{ background:#fffee0;}
table.listTable tr.selected td{background:#CFD1D2;}
table.listTable tr.selected:hover td{background:#c2c2c2;}
table.listTable tr.data:hover table.in-infoTable td{ background:none;}
table.listTable tr.data table.in-infoTable td:first-child{ border-left:none;}
.td-opeation a.btn{ margin:2px 5px 3px 0px;}
table.listTable td.padding-0{ padding:0px!important;}
table.listTable td.vertical-align-top{ vertical-align:top;}
table.listTable ul.in-list{}
table.listTable ul.in-list li{ border-bottom:1px solid #f4f4f4; padding:10px 12px;}
table.listTable ul.in-list li:last-child{ border-bottom:0px;}
table.listTable ul.in-list li span{ padding-left:5px;}
table.listTable ul.in-list li span.charge{ padding:0px 5px 0px 0px;}
table.listTable ul.in-list li em{ color:#ea4d00; font-size:12px; font-style:normal; padding:0px 10px;}
table.listTable ul.in-list li .group-name{ font-style:normal; padding:0px 0px 0px 0px;}
input.text{padding:4px 8px 4px 8px;height:20px;line-height:20px;font-size:14px;color:#555;
background-color:#fff;border:1px solid #ccc;box-shadow:inset 0px 1px 1px rgba(0,0,0,0.075);
transition:border linear .2s,box-shadow linear .2s;}
input.text:hover,input.text:focus{background:#fcfcfc;border:1px solid #3498db;color:#000;
-webkit-box-shadow:0px 0px 3px #6bafdc;-moz-box-shadow:0px 0px 3px #6bafdc;box-shadow:0px 0px 3px #6bafdc;}
input.text-price{ font-size:14px; width:80px;}
input.text-stock{ width:60px;}
input.text-goods-sn{ width:128px;}
/* 各种按钮 */
.btn,.btn:visited{
background-color:#eee;
background-image:-webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, #f6f6f6), color-stop(100%, #e6e6e6));
background-image:-webkit-linear-gradient(#f6f6f6,#e6e6e6);
background-image:-moz-linear-gradient(#f6f6f6,#e6e6e6);
background-image:-o-linear-gradient(#f6f6f6,#e6e6e6);
background-image:linear-gradient(#f6f6f6,#e6e6e6);
-webkit-box-shadow:#fff 0px 1px 0px inset;
-moz-box-shadow:#fff 0px 1px 0px inset;
box-shadow:#fff 0px 1px 0px inset;
border:1px solid #aaa;
border-bottom-color:#888;
color:#555;
text-shadow:0px 1px 0px #f8f8f8;
-webkit-border-radius:3px; -moz-border-radius:3px; border-radius:3px;
display:inline-block; font-size:14px; line-height:20px; padding:3px 11px 3px 11px; position:relative;
}
.btn:hover{
background-color:#ddd;
background-image:-webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, #e8e8e8), color-stop(100%, #d8d8d8));
background-image:-webkit-linear-gradient(#e8e8e8,#d8d8d8);
background-image:-moz-linear-gradient(#e8e8e8,#d8d8d8);
background-image:-o-linear-gradient(#e8e8e8,#d8d8d8);
background-image:linear-gradient(#e8e8e8,#d8d8d8);
-webkit-box-shadow:rgba(0,0,0,0.3) 0 1px 3px,#fff 0px 1px 0px inset;
-moz-box-shadow:rgba(0,0,0,0.3) 0 1px 3px,#fff 0px 1px 0px inset;
box-shadow:rgba(0,0,0,0.3) 0 1px 3px,#fff 0px 1px 0px inset;
border-color:#888;
border-bottom-color:#666;
color:#333;
text-decoration:none;
}
</style>
</head>

<body>

<!--头部开始-->
{include file="/member/m_top"}
<!-- 非头尾的内容 START -->
<!--面包屑导航开始-->
<div class="breadcrumb clearfix " >
</div>
<!--面包屑导航结束-->

<div class="main clearfix" >
{include file="/member/m_left"}
	<div class="contents fr m20">
      <div class="clearfix">
		<div class="location">会员中心  > 商品管理   > 编辑商品</div>
		<div class="hyAdd">
			<div class="hyAddT">
				<ul>
				<li onClick="location='{:url('home/mshangpin/mspupd','id='.$obj['id'])}'"><span>商品基础信息</span></li>
				<li onClick="location='{:url('home/mshangpin/mspupddetail','id='.$obj['id'])}'"><span>商品详细</span></li>
				<li onClick="location='{:url('home/mshangpin/mspupdimages','id='.$obj['id'])}'"><span>商品相册</span></li>
				<li onClick="location='{:url('home/mshangpin/mspupdnorms','id='.$obj['id'])}'" class="hyAddT-current"><span>规格/参数</span></li>
				<li onClick="location='{:url('home/mshangpin/mspupdrule','id='.$obj['id'])}'"><span>批发价格</span></li>
				</ul>
			</div>
			<form id="addform" method="post" action="">
			<div class="hyAddB">
				<div class="hy-gg">
					<div class="hy-ggT">
						<div class="hy-ggTT">
							<a href="javascript:void(0);" id="setsgnorms" class="szjg fl">设置商品规格</a>
							<p class="fl">普通商品可不用设置商品规格，若要设置请先填写[商品信息]部分的商品货号/价格等信息，以便自动复制信息到货品</p>
						</div>
						<div class="hy-ggTB" id="snidlist">
							{volist name="snkvarr" id="item"}
							<div id="snidlist_{$key}" _listid="{$key}">
							<h3 class="dr_snid_{$key}">{$shopnorms[$key]['name']}</h3>
							<ul class="dr_snid_{$key}">
						  	{php}foreach($item as $kkk=>$vvv){{/php}
							<li><b class="fl">{$snormsval[$kkk]['name']}</b><a class="fl"></a></li>
						  	{php}}{/php}
							</ul>
							</div>
							{/volist}
						</div>
					</div>
					<div id="addtable">
						{php}if(!empty($list)){{/php}
						<table class="listTable" border="0" cellpadding="0" cellspacing="0">
						<thead>
							<tr class="thead">
							{volist name="snkvarr" id="val"}
							{php}if($key>0){echo '<th>'.$shopnorms[$key]['name'].'</th>';}{/php}
							{/volist}
							<th><i class="important">*</i>商品货号</th>
							<th><i class="important">*</i>库存</th>
							<th>市场价</th>
							<th><i class="important">*</i>销售价</th>
							<th>删除</th>
							</tr>
						</thead>
						<tbody>
							{php}$iii=0;{/php}
							{volist name="list" id="val"}
							{php}$iii+=1;{/php}
							<tr class="data" _i="{$iii}">
							{php}if($val['snvidone']>0){echo '<td>'.$snormsval[$val['snvidone']]['name'].'</td>';}{/php}
							{php}if($val['snvidtwo']>0){echo '<td>'.$snormsval[$val['snvidtwo']]['name'].'</td>';}{/php}
							{php}if($val['snvidthree']>0){echo '<td>'.$snormsval[$val['snvidthree']]['name'].'</td>';}{/php}
							<td>
							<input type="hidden" name="ids[]" value="{$val['id']}" />
							{php}$snvstr=$val['snvstr'];{/php}
							{php}if(substr($snvstr,0,1)==","){ $snvstr=substr($snvstr,1); }{/php}
							<input type="hidden" name="snvstr[]" value="{$snvstr}" />
							{php}$snidstr=$val['snidstr'];{/php}
							{php}if(substr($snidstr,0,1)==","){ $snidstr=substr($snidstr,1); }{/php}
							<input type="hidden" name="snidstr[]" value="{$snidstr}" />
							<input type="text" class="text text-goods-sn" name="gno[]" value="{$val['gno']}" />
							</td>
							<td>
							<input type="text" class="text text-stock" name="stock_num[]" value="{$val['stock_num']}" />
							</td>
							<td>
							<input type="text" class="text text-price" name="old_price[]" value="{$val['old_price']}" />
							</td>
							<td>
							<input type="text" class="text text-price" name="price[]" value="{$val['price']}" />
							</td>
							<td>
							<a class="btn btn_del" href="javascript:;" _id="{$val['id']}">删除</a>
							</td>
							</tr>
							{/volist}
						</tbody>
						</table>
						{php}}{/php}
					</div>
				</div>
				<div class="hyAddB-01B">
					<a href="javascript:void(0);" id="submit" class="qdSave fl">确定保存</a>
					<a href="javascript:void(0);" id="reset" class="hyAdd-cz fl">重置</a>
				</div>
			</div>
			</form>
		</div>
	  </div>
	</div>
</div>
<!-- 非头尾的内容 END -->
<div class="pop_box">
  <div class="pop_boxc01">
	<div class="pop_boxc01T">
		<h3 class="fl">更新订单进度</h3>
		<a href="javascript:void(0);" class="fr del_pop_box">x</a>
	</div>
	<div class="pop_boxc01M">
		<div class="pop_boxc01M-01">说明更新订单进度说明更新订单进度说明说明说明说明</div>
		{volist name="snormskeyval" id="item"}
		<div class="pop_boxc01M-02 ntoplie">
			<div class="pop_boxc01M-02T ntoptou">
				<label>
				<input type="checkbox" value="{$key}" class="fl" />
				<b class="fl snidval_{$key}">{$shopnorms[$key]['name']}</b>
				<span class="fl">（{$shopnorms[$key]['alias']}）</span>
				</label>
			</div>
			<div class="pop_boxc01M-02B nsonlie">
				{php}foreach($item as $kkk=>$vvv){{/php}
				<label>
				<input type="checkbox" value="{$vvv}" class="d_n" _snid="{$key}" />
				<span class="snvidval_{$vvv}">{$snormsval[$vvv]['name']}</span>
				</label>
				{php}}{/php}
			</div>
		</div>
		{/volist}
	</div>
	<div class="pop_boxc01B">
		<div id="snidlie"></div>
		<div id="snvidlie"></div>
		<a href="javascript:void(0);" class="aSubmit">确认</a>
		<a href="javascript:void(0);" class="aClose del_pop_box">关闭</a>
	</div>
  </div>
</div>
<script type="text/javascript">
$(function(){
	//提交
	$('#submit').click(function(){
		$("#addform").submit();
	});
	$("#setsgnorms").click(function(){
		$(".pop_box").show();
	});
	$(".del_pop_box").click(function(){
		$(".pop_box").hide();
	});
	$('.ntoptou input[type="checkbox"]').click(function(){
		var snid = $(this).val();
		var snidnum = $("#snidlie").children().length + 1;
		var snid_len = $("#snvidlie .snid_"+snid).length; //length>0判断元素是否存在
		if($(this).is(':checked')){
			if(snidnum > 3){
				alert("最多只能选择3种商品规格！");
				return false;
			}
			if(!(snid_len>0)){
				$("#snidlie").append('<a class="snid_'+snid+'" _snid="'+snid+'"></a>');
			}
			$("#snvidlie").find(".snid_"+snid).remove();
			$(this).parents(".ntoplie").find(".nsonlie input").each(function(){
				var ids = $(this).val();
				$("#snvidlie").append('<a class="snvid_'+ids+' snid_'+snid+'" _snvid="'+ids+'"></a>');
			});
			$(this).parents(".ntoplie").find('.nsonlie input[type="checkbox"]').attr("checked","true");
			$(this).parents(".ntoplie").find(".nsonlie span").addClass("chkbg");
		}else{
			$("#snidlie").find(".snid_"+snid).remove();
			$("#snvidlie").find(".snid_"+snid).remove();
			$(this).parents(".ntoplie").find('.nsonlie input[type="checkbox"]').prop("checked");
			$(this).parents(".ntoplie").find(".nsonlie span").removeClass("chkbg");
		}
	});
	$('.nsonlie input[type="checkbox"]').click(function(){
		var snid = $(this).attr("_snid");
		var snvid = $(this).val();
		var snidnum = $("#snidlie").children().length;
		var snid_len = $("#snvidlie .snid_"+snid).length; //length>0判断元素是否存在
		var snvid_len = $(".snvid_"+snvid).length;
		var is_snid = 0;
		if($(this).is(':checked')){
			if((snidnum+1) > 3){
				$("#snidlie a").each(function(){
					var ids = $(this).attr("_snid");
					if(snid==ids){
						is_snid = ids;
					}
				});
				if(!(is_snid>0)){
					alert("最多只能选择3种商品规格！");
					return false;
				}
			}
			if(!(snid_len>0)){
				$("#snidlie").append('<a class="snid_'+snid+'" _snid="'+snid+'"></a>');
			}
			if(!(snvid_len>0)){
				$(this).parents(".ntoplie").find('.ntoptou input[type="checkbox"]').attr("checked","true");
				$("#snvidlie").append('<a class="snvid_'+snvid+' snid_'+snid+'" _snvid="'+snvid+'"></a>');
			}
			$(this).next("span").addClass("chkbg");
		}else{
			$("#snvidlie").find(".snvid_"+snvid).remove();
			var snid_len = $("#snvidlie .snid_"+snid).length;
			if(!(snid_len>0)){
				$("#snidlie").find(".snid_"+snid).remove();
				$(this).parents(".ntoplie").find('.ntoptou input[type="checkbox"]').removeAttr("checked");
			}
			$(this).next("span").removeClass("chkbg");
		}
	});
	//导入选择的规格
	$(".aSubmit").click(function(){
		var snid_str = '';
		var snids = [];
		$("#snidlie a").each(function(){
			var snid = $(this).attr("_snid");
			snids.push(snid);
		});
		snid_str = snids.join(",");
		var snvid_str = '';
		var snvids = [];
		$("#snvidlie a").each(function(){
			var snvid = $(this).attr("_snvid");
			snvids.push(snvid);
		});
		snvid_str = snvids.join(",");
		if(snvid_str!=''){
			var url = "{:url('home/mshangpin/getnormsbysnvids','id='.$obj['id'])}";
			$.post(url,{snvid_str:snvid_str,snid_str:snid_str},function(data){
				var html = '';
				$.each(data.snkvarr, function(key, val){
					var snidval = $(".snidval_"+key).html();
					html+= '<div id="snidlist_'+key+'" _listid="'+key+'">';
					html+= '<h3 class="dr_snid_'+key+'">'+snidval+'</h3>';
					html+= '<ul class="dr_snid_'+key+'">';
					$.each(val, function(kkk, vvv){
						var snvidval = $(".snvidval_"+vvv).html();
						html+= '<li><b class="fl">'+snvidval+'</b><a class="fl"></a></li>';
					});
					html+= '</ul>';
					html+= '</div>';
				});
				$("#snidlist").html(html);
				$("#addtable").html(data.html);
			},'json');
		}
		$(".pop_box").hide();
		$(".ntoplie").find('input[type="checkbox"]').removeAttr("checked");
		$(".ntoplie").find("span").removeClass("chkbg");
		$("#snidlie").empty();
		$("#snvidlie").empty();
	});
	$(".btn_del").live('click',function(){
		if(confirm("您确定要删除此行数据吗？")){
			var id = $(this).attr("_id");
			if(id>0){
				$.post("{:url('home/mshangpin/delsnvid')}",{id:id});
				location.reload();
			}
			$(this).parents("tr.data").find("input,a").remove();
		}
	});
});
</script>

{include file="/member/m_footer"}

</body>
</html>
